SUBROUTINE mg511_prib (mxd, u, w)
integer, intent (in) :: mxd
real (kind=wp), intent (in) :: u(0:)
real (kind=wp), intent (out) :: w(0:mg511_npb(mxd)-1)
!-----------------------------------------------------------------------
if (size(u).ne.nr) then
 stop 'mg511_prib: bad size u'
!! else if (size(w).ne.mg511_npb(mxd)) then
!!  stop 'mg511_prib: bad size w'
endif
! The following code was obtained using these parameters
! prims, dnpr(0:*): 0 4 4 4 4 4 1 0 0 0
! prib,  dnpb(0:*): 1 4 14 40 105 252 571 1224 2518 4984
! constant term
w(0) = 1
! terms of degree 1
if (1.le.mxd) then
 w(1) = u(0)*w(0)
 w(2) = u(1)*w(0)
 w(3) = u(2)*w(0)
 w(4) = u(3)*w(0)
endif
! terms of degree 2
if (2.le.mxd) then
 w(5:8) = u(0)*w(1:4)
 w(9:11) = u(1)*w(2:4)
 w(12:13) = u(2)*w(3:4)
 w(14) = u(3)*w(4)
 w(15) = u(4)*w(0)
 w(16) = u(5)*w(0)
 w(17) = u(6)*w(0)
 w(18) = u(7)*w(0)
endif
! terms of degree 3
if (3.le.mxd) then
 w(19:32) = u(0)*w(5:18)
 w(33:42) = u(1)*w(9:18)
 w(43:49) = u(2)*w(12:18)
 w(50:54) = u(3)*w(14:18)
 w(55) = u(8)*w(0)
 w(56) = u(9)*w(0)
 w(57) = u(10)*w(0)
 w(58) = u(11)*w(0)
endif
! terms of degree 4
if (4.le.mxd) then
 w(59:98) = u(0)*w(19:58)
 w(99:124) = u(1)*w(33:58)
 w(125:140) = u(2)*w(43:58)
 w(141:149) = u(3)*w(50:58)
 w(150:153) = u(4)*w(15:18)
 w(154:156) = u(5)*w(16:18)
 w(157:158) = u(6)*w(17:18)
 w(159) = u(7)*w(18)
 w(160) = u(12)*w(0)
 w(161) = u(13)*w(0)
 w(162) = u(14)*w(0)
 w(163) = u(15)*w(0)
endif
! terms of degree 5
if (5.le.mxd) then
 w(164:268) = u(0)*w(59:163)
 w(269:333) = u(1)*w(99:163)
 w(334:372) = u(2)*w(125:163)
 w(373:395) = u(3)*w(141:163)
 w(396:399) = u(4)*w(55:58)
 w(400:403) = u(5)*w(55:58)
 w(404:407) = u(6)*w(55:58)
 w(408:411) = u(7)*w(55:58)
 w(412) = u(16)*w(0)
 w(413) = u(17)*w(0)
 w(414) = u(18)*w(0)
 w(415) = u(19)*w(0)
endif
! terms of degree 6
if (6.le.mxd) then
 w(416:667) = u(0)*w(164:415)
 w(668:814) = u(1)*w(269:415)
 w(815:896) = u(2)*w(334:415)
 w(897:939) = u(3)*w(373:415)
 w(940:953) = u(4)*w(150:163)
 w(954:963) = u(5)*w(154:163)
 w(964:970) = u(6)*w(157:163)
 w(971:975) = u(7)*w(159:163)
 w(976:979) = u(8)*w(55:58)
 w(980:982) = u(9)*w(56:58)
 w(983:984) = u(10)*w(57:58)
 w(985) = u(11)*w(58)
 w(986) = u(20)*w(0)
endif
! terms of degree 7
if (7.le.mxd) then
 w(987:1557) = u(0)*w(416:986)
 w(1558:1876) = u(1)*w(668:986)
 w(1877:2048) = u(2)*w(815:986)
 w(2049:2138) = u(3)*w(897:986)
 w(2139:2158) = u(4)*w(396:415)
 w(2159:2174) = u(5)*w(400:415)
 w(2175:2186) = u(6)*w(404:415)
 w(2187:2194) = u(7)*w(408:415)
 w(2195:2198) = u(8)*w(160:163)
 w(2199:2202) = u(9)*w(160:163)
 w(2203:2206) = u(10)*w(160:163)
 w(2207:2210) = u(11)*w(160:163)
endif
! terms of degree 8
if (8.le.mxd) then
 w(2211:3434) = u(0)*w(987:2210)
 w(3435:4087) = u(1)*w(1558:2210)
 w(4088:4421) = u(2)*w(1877:2210)
 w(4422:4583) = u(3)*w(2049:2210)
 w(4584:4630) = u(4)*w(940:986)
 w(4631:4663) = u(5)*w(954:986)
 w(4664:4686) = u(6)*w(964:986)
 w(4687:4702) = u(7)*w(971:986)
 w(4703:4706) = u(8)*w(412:415)
 w(4707:4710) = u(9)*w(412:415)
 w(4711:4714) = u(10)*w(412:415)
 w(4715:4718) = u(11)*w(412:415)
 w(4719:4722) = u(12)*w(160:163)
 w(4723:4725) = u(13)*w(161:163)
 w(4726:4727) = u(14)*w(162:163)
 w(4728) = u(15)*w(163)
endif
! terms of degree 9
if (9.le.mxd) then
 w(4729:7246) = u(0)*w(2211:4728)
 w(7247:8540) = u(1)*w(3435:4728)
 w(8541:9181) = u(2)*w(4088:4728)
 w(9182:9488) = u(3)*w(4422:4728)
 w(9489:9560) = u(4)*w(2139:2210)
 w(9561:9612) = u(5)*w(2159:2210)
 w(9613:9648) = u(6)*w(2175:2210)
 w(9649:9672) = u(7)*w(2187:2210)
 w(9673:9683) = u(8)*w(976:986)
 w(9684:9690) = u(9)*w(980:986)
 w(9691:9694) = u(10)*w(983:986)
 w(9695:9696) = u(11)*w(985:986)
 w(9697:9700) = u(12)*w(412:415)
 w(9701:9704) = u(13)*w(412:415)
 w(9705:9708) = u(14)*w(412:415)
 w(9709:9712) = u(15)*w(412:415)
endif
END SUBROUTINE mg511_prib
