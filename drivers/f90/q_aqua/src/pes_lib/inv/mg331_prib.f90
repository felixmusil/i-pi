SUBROUTINE mg331_prib (mxd, u, w)
integer, intent (in) :: mxd
real (kind=wp), intent (in) :: u(0:)
real (kind=wp), intent (out) :: w(0:mg331_npb(mxd)-1)
!-----------------------------------------------------------------------
if (size(u).ne.nr) then
 stop 'mg331_prib: bad size u'
!! else if (size(w).ne.mg331_npb(mxd)) then
!!  stop 'mg331_prib: bad size w'
endif
! The following code was obtained using these parameters
! prims, dnpr(0:*): 0 5 7 7 1 0 1 0 0 0
! prib,  dnpb(0:*): 1 5 22 77 239 670 1745 4255 9849 21762
! constant term
w(0) = 1
! terms of degree 1
if (1.le.mxd) then
 w(1) = u(0)*w(0)
 w(2) = u(1)*w(0)
 w(3) = u(2)*w(0)
 w(4) = u(3)*w(0)
 w(5) = u(4)*w(0)
endif
! terms of degree 2
if (2.le.mxd) then
 w(6:10) = u(0)*w(1:5)
 w(11:14) = u(1)*w(2:5)
 w(15:17) = u(2)*w(3:5)
 w(18:19) = u(3)*w(4:5)
 w(20) = u(4)*w(5)
 w(21) = u(5)*w(0)
 w(22) = u(6)*w(0)
 w(23) = u(7)*w(0)
 w(24) = u(8)*w(0)
 w(25) = u(9)*w(0)
 w(26) = u(10)*w(0)
 w(27) = u(11)*w(0)
endif
! terms of degree 3
if (3.le.mxd) then
 w(28:49) = u(0)*w(6:27)
 w(50:66) = u(1)*w(11:27)
 w(67:79) = u(2)*w(15:27)
 w(80:89) = u(3)*w(18:27)
 w(90:97) = u(4)*w(20:27)
 w(98) = u(12)*w(0)
 w(99) = u(13)*w(0)
 w(100) = u(14)*w(0)
 w(101) = u(15)*w(0)
 w(102) = u(16)*w(0)
 w(103) = u(17)*w(0)
 w(104) = u(18)*w(0)
endif
! terms of degree 4
if (4.le.mxd) then
 w(105:181) = u(0)*w(28:104)
 w(182:236) = u(1)*w(50:104)
 w(237:274) = u(2)*w(67:104)
 w(275:299) = u(3)*w(80:104)
 w(300:314) = u(4)*w(90:104)
 w(315:321) = u(5)*w(21:27)
 w(322:327) = u(6)*w(22:27)
 w(328:332) = u(7)*w(23:27)
 w(333:336) = u(8)*w(24:27)
 w(337:339) = u(9)*w(25:27)
 w(340:341) = u(10)*w(26:27)
 w(342) = u(11)*w(27)
 w(343) = u(19)*w(0)
endif
! terms of degree 5
if (5.le.mxd) then
 w(344:582) = u(0)*w(105:343)
 w(583:744) = u(1)*w(182:343)
 w(745:851) = u(2)*w(237:343)
 w(852:920) = u(3)*w(275:343)
 w(921:964) = u(4)*w(300:343)
 w(965:971) = u(5)*w(98:104)
 w(972:978) = u(6)*w(98:104)
 w(979:985) = u(7)*w(98:104)
 w(986:992) = u(8)*w(98:104)
 w(993:999) = u(9)*w(98:104)
 w(1000:1006) = u(10)*w(98:104)
 w(1007:1013) = u(11)*w(98:104)
endif
! terms of degree 6
if (6.le.mxd) then
 w(1014:1683) = u(0)*w(344:1013)
 w(1684:2114) = u(1)*w(583:1013)
 w(2115:2383) = u(2)*w(745:1013)
 w(2384:2545) = u(3)*w(852:1013)
 w(2546:2638) = u(4)*w(921:1013)
 w(2639:2667) = u(5)*w(315:343)
 w(2668:2689) = u(6)*w(322:343)
 w(2690:2705) = u(7)*w(328:343)
 w(2706:2716) = u(8)*w(333:343)
 w(2717:2723) = u(9)*w(337:343)
 w(2724:2727) = u(10)*w(340:343)
 w(2728:2729) = u(11)*w(342:343)
 w(2730:2736) = u(12)*w(98:104)
 w(2737:2742) = u(13)*w(99:104)
 w(2743:2747) = u(14)*w(100:104)
 w(2748:2751) = u(15)*w(101:104)
 w(2752:2754) = u(16)*w(102:104)
 w(2755:2756) = u(17)*w(103:104)
 w(2757) = u(18)*w(104)
 w(2758) = u(20)*w(0)
endif
! terms of degree 7
if (7.le.mxd) then
 w(2759:4503) = u(0)*w(1014:2758)
 w(4504:5578) = u(1)*w(1684:2758)
 w(5579:6222) = u(2)*w(2115:2758)
 w(6223:6597) = u(3)*w(2384:2758)
 w(6598:6810) = u(4)*w(2546:2758)
 w(6811:6859) = u(5)*w(965:1013)
 w(6860:6901) = u(6)*w(972:1013)
 w(6902:6936) = u(7)*w(979:1013)
 w(6937:6964) = u(8)*w(986:1013)
 w(6965:6985) = u(9)*w(993:1013)
 w(6986:6999) = u(10)*w(1000:1013)
 w(7000:7006) = u(11)*w(1007:1013)
 w(7007) = u(12)*w(343)
 w(7008) = u(13)*w(343)
 w(7009) = u(14)*w(343)
 w(7010) = u(15)*w(343)
 w(7011) = u(16)*w(343)
 w(7012) = u(17)*w(343)
 w(7013) = u(18)*w(343)
endif
! terms of degree 8
if (8.le.mxd) then
 w(7014:11268) = u(0)*w(2759:7013)
 w(11269:13778) = u(1)*w(4504:7013)
 w(13779:15213) = u(2)*w(5579:7013)
 w(15214:16004) = u(3)*w(6223:7013)
 w(16005:16420) = u(4)*w(6598:7013)
 w(16421:16540) = u(5)*w(2639:2758)
 w(16541:16631) = u(6)*w(2668:2758)
 w(16632:16700) = u(7)*w(2690:2758)
 w(16701:16753) = u(8)*w(2706:2758)
 w(16754:16795) = u(9)*w(2717:2758)
 w(16796:16830) = u(10)*w(2724:2758)
 w(16831:16861) = u(11)*w(2728:2758)
 w(16862) = u(19)*w(343)
endif
! terms of degree 9
if (9.le.mxd) then
 w(16863:26711) = u(0)*w(7014:16862)
 w(26712:32305) = u(1)*w(11269:16862)
 w(32306:35389) = u(2)*w(13779:16862)
 w(35390:37038) = u(3)*w(15214:16862)
 w(37039:37896) = u(4)*w(16005:16862)
 w(37897:38099) = u(5)*w(6811:7013)
 w(38100:38253) = u(6)*w(6860:7013)
 w(38254:38365) = u(7)*w(6902:7013)
 w(38366:38442) = u(8)*w(6937:7013)
 w(38443:38491) = u(9)*w(6965:7013)
 w(38492:38519) = u(10)*w(6986:7013)
 w(38520:38533) = u(11)*w(7000:7013)
 w(38534:38562) = u(12)*w(2730:2758)
 w(38563:38584) = u(13)*w(2737:2758)
 w(38585:38600) = u(14)*w(2743:2758)
 w(38601:38611) = u(15)*w(2748:2758)
 w(38612:38618) = u(16)*w(2752:2758)
 w(38619:38622) = u(17)*w(2755:2758)
 w(38623:38624) = u(18)*w(2757:2758)
endif
END SUBROUTINE mg331_prib
