SUBROUTINE mg421_prib (mxd, u, w)
integer, intent (in) :: mxd
real (kind=wp), intent (in) :: u(0:)
real (kind=wp), intent (out) :: w(0:mg421_npb(mxd)-1)
!-----------------------------------------------------------------------
if (size(u).ne.nr) then
 stop 'mg421_prib: bad size u'
!! else if (size(w).ne.mg421_npb(mxd)) then
!!  stop 'mg421_prib: bad size w'
endif
! The following code was obtained using these parameters
! prims, dnpr(0:*): 0 5 7 4 4 0 1 0 0 0
! prib,  dnpb(0:*): 1 5 22 74 227 619 1583 3775 8583 18599
! constant term
w(0) = 1
! terms of degree 1
if (1.le.mxd) then
 w(1) = u(0)*w(0)
 w(2) = u(1)*w(0)
 w(3) = u(2)*w(0)
 w(4) = u(3)*w(0)
 w(5) = u(4)*w(0)
endif
! terms of degree 2
if (2.le.mxd) then
 w(6:10) = u(0)*w(1:5)
 w(11:14) = u(1)*w(2:5)
 w(15:17) = u(2)*w(3:5)
 w(18:19) = u(3)*w(4:5)
 w(20) = u(4)*w(5)
 w(21) = u(5)*w(0)
 w(22) = u(6)*w(0)
 w(23) = u(7)*w(0)
 w(24) = u(8)*w(0)
 w(25) = u(9)*w(0)
 w(26) = u(10)*w(0)
 w(27) = u(11)*w(0)
endif
! terms of degree 3
if (3.le.mxd) then
 w(28:49) = u(0)*w(6:27)
 w(50:66) = u(1)*w(11:27)
 w(67:79) = u(2)*w(15:27)
 w(80:89) = u(3)*w(18:27)
 w(90:97) = u(4)*w(20:27)
 w(98) = u(12)*w(0)
 w(99) = u(13)*w(0)
 w(100) = u(14)*w(0)
 w(101) = u(15)*w(0)
endif
! terms of degree 4
if (4.le.mxd) then
 w(102:175) = u(0)*w(28:101)
 w(176:227) = u(1)*w(50:101)
 w(228:262) = u(2)*w(67:101)
 w(263:284) = u(3)*w(80:101)
 w(285:296) = u(4)*w(90:101)
 w(297:303) = u(5)*w(21:27)
 w(304:309) = u(6)*w(22:27)
 w(310:314) = u(7)*w(23:27)
 w(315:318) = u(8)*w(24:27)
 w(319:321) = u(9)*w(25:27)
 w(322:323) = u(10)*w(26:27)
 w(324) = u(11)*w(27)
 w(325) = u(16)*w(0)
 w(326) = u(17)*w(0)
 w(327) = u(18)*w(0)
 w(328) = u(19)*w(0)
endif
! terms of degree 5
if (5.le.mxd) then
 w(329:555) = u(0)*w(102:328)
 w(556:708) = u(1)*w(176:328)
 w(709:809) = u(2)*w(228:328)
 w(810:875) = u(3)*w(263:328)
 w(876:919) = u(4)*w(285:328)
 w(920:923) = u(5)*w(98:101)
 w(924:927) = u(6)*w(98:101)
 w(928:931) = u(7)*w(98:101)
 w(932:935) = u(8)*w(98:101)
 w(936:939) = u(9)*w(98:101)
 w(940:943) = u(10)*w(98:101)
 w(944:947) = u(11)*w(98:101)
endif
! terms of degree 6
if (6.le.mxd) then
 w(948:1566) = u(0)*w(329:947)
 w(1567:1958) = u(1)*w(556:947)
 w(1959:2197) = u(2)*w(709:947)
 w(2198:2335) = u(3)*w(810:947)
 w(2336:2407) = u(4)*w(876:947)
 w(2408:2439) = u(5)*w(297:328)
 w(2440:2464) = u(6)*w(304:328)
 w(2465:2483) = u(7)*w(310:328)
 w(2484:2497) = u(8)*w(315:328)
 w(2498:2507) = u(9)*w(319:328)
 w(2508:2514) = u(10)*w(322:328)
 w(2515:2519) = u(11)*w(324:328)
 w(2520:2523) = u(12)*w(98:101)
 w(2524:2526) = u(13)*w(99:101)
 w(2527:2528) = u(14)*w(100:101)
 w(2529) = u(15)*w(101)
 w(2530) = u(20)*w(0)
endif
! terms of degree 7
if (7.le.mxd) then
 w(2531:4113) = u(0)*w(948:2530)
 w(4114:5077) = u(1)*w(1567:2530)
 w(5078:5649) = u(2)*w(1959:2530)
 w(5650:5982) = u(3)*w(2198:2530)
 w(5983:6177) = u(4)*w(2336:2530)
 w(6178:6205) = u(5)*w(920:947)
 w(6206:6229) = u(6)*w(924:947)
 w(6230:6249) = u(7)*w(928:947)
 w(6250:6265) = u(8)*w(932:947)
 w(6266:6277) = u(9)*w(936:947)
 w(6278:6285) = u(10)*w(940:947)
 w(6286:6289) = u(11)*w(944:947)
 w(6290:6293) = u(12)*w(325:328)
 w(6294:6297) = u(13)*w(325:328)
 w(6298:6301) = u(14)*w(325:328)
 w(6302:6305) = u(15)*w(325:328)
endif
! terms of degree 8
if (8.le.mxd) then
 w(6306:10080) = u(0)*w(2531:6305)
 w(10081:12272) = u(1)*w(4114:6305)
 w(12273:13500) = u(2)*w(5078:6305)
 w(13501:14156) = u(3)*w(5650:6305)
 w(14157:14479) = u(4)*w(5983:6305)
 w(14480:14602) = u(5)*w(2408:2530)
 w(14603:14693) = u(6)*w(2440:2530)
 w(14694:14759) = u(7)*w(2465:2530)
 w(14760:14806) = u(8)*w(2484:2530)
 w(14807:14839) = u(9)*w(2498:2530)
 w(14840:14862) = u(10)*w(2508:2530)
 w(14863:14878) = u(11)*w(2515:2530)
 w(14879:14882) = u(16)*w(325:328)
 w(14883:14885) = u(17)*w(326:328)
 w(14886:14887) = u(18)*w(327:328)
 w(14888) = u(19)*w(328)
endif
! terms of degree 9
if (9.le.mxd) then
 w(14889:23471) = u(0)*w(6306:14888)
 w(23472:28279) = u(1)*w(10081:14888)
 w(28280:30895) = u(2)*w(12273:14888)
 w(30896:32283) = u(3)*w(13501:14888)
 w(32284:33015) = u(4)*w(14157:14888)
 w(33016:33143) = u(5)*w(6178:6305)
 w(33144:33243) = u(6)*w(6206:6305)
 w(33244:33319) = u(7)*w(6230:6305)
 w(33320:33375) = u(8)*w(6250:6305)
 w(33376:33415) = u(9)*w(6266:6305)
 w(33416:33443) = u(10)*w(6278:6305)
 w(33444:33463) = u(11)*w(6286:6305)
 w(33464:33474) = u(12)*w(2520:2530)
 w(33475:33481) = u(13)*w(2524:2530)
 w(33482:33485) = u(14)*w(2527:2530)
 w(33486:33487) = u(15)*w(2529:2530)
endif
END SUBROUTINE mg421_prib
