SUBROUTINE mg321_prib (mxd, u, w)
integer, intent (in) :: mxd
real (kind=wp), intent (in) :: u(0:)
real (kind=wp), intent (out) :: w(0:mg321_npb(mxd)-1)
!-----------------------------------------------------------------------
if (size(u).ne.nr) then
 stop 'mg321_prib: bad size u'
!! else if (size(w).ne.mg321_npb(mxd)) then
!!  stop 'mg321_prib: bad size w'
endif
! The following code was obtained using these parameters
! prims, dnpr(0:*): 0 5 6 3 0 0 1 0 0 0
! prib,  dnpb(0:*): 1 5 21 68 196 504 1203 2679 5661 11402
! constant term
w(0) = 1
! terms of degree 1
if (1.le.mxd) then
 w(1) = u(0)*w(0)
 w(2) = u(1)*w(0)
 w(3) = u(2)*w(0)
 w(4) = u(3)*w(0)
 w(5) = u(4)*w(0)
endif
! terms of degree 2
if (2.le.mxd) then
 w(6:10) = u(0)*w(1:5)
 w(11:14) = u(1)*w(2:5)
 w(15:17) = u(2)*w(3:5)
 w(18:19) = u(3)*w(4:5)
 w(20) = u(4)*w(5)
 w(21) = u(5)*w(0)
 w(22) = u(6)*w(0)
 w(23) = u(7)*w(0)
 w(24) = u(8)*w(0)
 w(25) = u(9)*w(0)
 w(26) = u(10)*w(0)
endif
! terms of degree 3
if (3.le.mxd) then
 w(27:47) = u(0)*w(6:26)
 w(48:63) = u(1)*w(11:26)
 w(64:75) = u(2)*w(15:26)
 w(76:84) = u(3)*w(18:26)
 w(85:91) = u(4)*w(20:26)
 w(92) = u(11)*w(0)
 w(93) = u(12)*w(0)
 w(94) = u(13)*w(0)
endif
! terms of degree 4
if (4.le.mxd) then
 w(95:162) = u(0)*w(27:94)
 w(163:209) = u(1)*w(48:94)
 w(210:240) = u(2)*w(64:94)
 w(241:259) = u(3)*w(76:94)
 w(260:269) = u(4)*w(85:94)
 w(270:275) = u(5)*w(21:26)
 w(276:280) = u(6)*w(22:26)
 w(281:284) = u(7)*w(23:26)
 w(285:287) = u(8)*w(24:26)
 w(288:289) = u(9)*w(25:26)
 w(290) = u(10)*w(26)
endif
! terms of degree 5
if (5.le.mxd) then
 w(291:486) = u(0)*w(95:290)
 w(487:614) = u(1)*w(163:290)
 w(615:695) = u(2)*w(210:290)
 w(696:745) = u(3)*w(241:290)
 w(746:776) = u(4)*w(260:290)
 w(777:779) = u(5)*w(92:94)
 w(780:782) = u(6)*w(92:94)
 w(783:785) = u(7)*w(92:94)
 w(786:788) = u(8)*w(92:94)
 w(789:791) = u(9)*w(92:94)
 w(792:794) = u(10)*w(92:94)
endif
! terms of degree 6
if (6.le.mxd) then
 w(795:1298) = u(0)*w(291:794)
 w(1299:1606) = u(1)*w(487:794)
 w(1607:1786) = u(2)*w(615:794)
 w(1787:1885) = u(3)*w(696:794)
 w(1886:1934) = u(4)*w(746:794)
 w(1935:1955) = u(5)*w(270:290)
 w(1956:1970) = u(6)*w(276:290)
 w(1971:1980) = u(7)*w(281:290)
 w(1981:1986) = u(8)*w(285:290)
 w(1987:1989) = u(9)*w(288:290)
 w(1990) = u(10)*w(290)
 w(1991:1993) = u(11)*w(92:94)
 w(1994:1995) = u(12)*w(93:94)
 w(1996) = u(13)*w(94)
 w(1997) = u(14)*w(0)
endif
! terms of degree 7
if (7.le.mxd) then
 w(1998:3200) = u(0)*w(795:1997)
 w(3201:3899) = u(1)*w(1299:1997)
 w(3900:4290) = u(2)*w(1607:1997)
 w(4291:4501) = u(3)*w(1787:1997)
 w(4502:4613) = u(4)*w(1886:1997)
 w(4614:4631) = u(5)*w(777:794)
 w(4632:4646) = u(6)*w(780:794)
 w(4647:4658) = u(7)*w(783:794)
 w(4659:4667) = u(8)*w(786:794)
 w(4668:4673) = u(9)*w(789:794)
 w(4674:4676) = u(10)*w(792:794)
endif
! terms of degree 8
if (8.le.mxd) then
 w(4677:7355) = u(0)*w(1998:4676)
 w(7356:8831) = u(1)*w(3201:4676)
 w(8832:9608) = u(2)*w(3900:4676)
 w(9609:9994) = u(3)*w(4291:4676)
 w(9995:10169) = u(4)*w(4502:4676)
 w(10170:10232) = u(5)*w(1935:1997)
 w(10233:10274) = u(6)*w(1956:1997)
 w(10275:10301) = u(7)*w(1971:1997)
 w(10302:10318) = u(8)*w(1981:1997)
 w(10319:10329) = u(9)*w(1987:1997)
 w(10330:10337) = u(10)*w(1990:1997)
endif
! terms of degree 9
if (9.le.mxd) then
 w(10338:15998) = u(0)*w(4677:10337)
 w(15999:18980) = u(1)*w(7356:10337)
 w(18981:20486) = u(2)*w(8832:10337)
 w(20487:21215) = u(3)*w(9609:10337)
 w(21216:21558) = u(4)*w(9995:10337)
 w(21559:21621) = u(5)*w(4614:4676)
 w(21622:21666) = u(6)*w(4632:4676)
 w(21667:21696) = u(7)*w(4647:4676)
 w(21697:21714) = u(8)*w(4659:4676)
 w(21715:21723) = u(9)*w(4668:4676)
 w(21724:21726) = u(10)*w(4674:4676)
 w(21727:21733) = u(11)*w(1991:1997)
 w(21734:21737) = u(12)*w(1994:1997)
 w(21738:21739) = u(13)*w(1996:1997)
endif
END SUBROUTINE mg321_prib
